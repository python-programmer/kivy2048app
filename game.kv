#: set PADDING 10
#: import utils kivy.utils

<CustomLabel@Label>:
    font_name: 'Roboto'

<ScoreLabel@CustomLabel>:
    markup: True
    bold: True
    halign: 'center'
    color: utils.get_color_from_hex('EEEEEE')

<ScoreLayout@BoxLayout>:
    orientation: 'vertical'
    text: ''
    source: None
    font_size: 0
    spacing: PADDING / 4
    padding: [PADDING / 2, PADDING / 2]
    canvas.before:
        Color:
            rgb: utils.get_color_from_hex('546e7a')
        BorderImage:
            source: 'data/img/cell.png'
            pos: self.pos
            size: self.size
        
    Image:
        source: root.source
    ScoreLabel:
        text: root.text
        font_size: root.font_size
    

<BaseButton>:
    font_name: 'Roboto'
    bold: True
    border: [2, 2, 2, 2]
    on_press: root.touchSound.play()

<DefaultButton@BaseButton>:
    background_normal: 'data/img/default_background_normal.png'
    background_down: 'data/img/default_background_down.png'
    color: utils.get_color_from_hex('546E7A')

<ImageButton@DefaultButton>:
    source: None
    StackLayout:
        pos: self.parent.pos
        size: self.parent.size
        orientation: 'lr-tb'
        padding: [PADDING / 2, PADDING / 2]
        Image:
            source: root.source

<DangerButton@BaseButton>:
    background_normal: 'data/img/danger_background_normal.png'
    background_down: 'data/img/danger_background_down.png'

<InfoButton@BaseButton>:
    background_normal: 'data/img/info_background_normal.png'
    background_down: 'data/img/info_background_down.png'

BoxLayout:
    base_size: board.width
    orientation: 'vertical'
    padding: [0, PADDING]
    BoxLayout:
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
        size_hint: (None, 1.0)
        size_hint_y: 12
        width: root.base_size
        padding: [PADDING / 2, PADDING / 2]
        spacing: PADDING / 2
        CustomLabel:
            text: '2048[sup]kivy[/sup]'
            markup: True
            bold: True
            size_hint_x: 34
            font_size: root.base_size / 16
            text_size: self.size
            halign: 'left'
            valign: 'middle'
        ScoreLayout:
            size_hint_x: 33
            text: str(board.best_score)
            font_size: root.base_size / 24
            source: 'data/img/best.png'
        ScoreLayout:
            size_hint_x: 33
            text: str(board.score)
            font_size: root.base_size / 24
            source: 'data/img/score.png'


    FloatLayout:
        id: floatLayout
        size_hint_y: 76
        Board:
            id: board
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            size_hint: (None, None)
            size: [min(floatLayout.width, floatLayout.height) - 2 * PADDING] * 2

    BoxLayout:
        orientation: 'horizontal'
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
        size_hint: (None, 1.0)
        width: root.base_size
        size_hint_y: 12
        spacing: PADDING / 2
        padding: [0, PADDING]

        ImageButton:
            size_hint_x: 50
            on_press: board.show_popup()
            source: 'data/img/reset.png'

        ImageButton:
            size_hint_x: 50
            on_press: board.toggle_music()
            id: btn_sound
            source: 'data/img/sound.png'

<Tile>:
    canvas:
        Color:
            rgb: self.color
        BorderImage:
            pos: self.pos
            size: self.size
            source: 'data/img/cell.png'

    CustomLabel:
        pos: root.pos
        size: root.size
        text: str(root.number)
        color: root.number_color
        font_size: root.font_size
        bold: True

<CustomPopup@Popup>:
    base_size: app.root.ids.board.width
    title_color: utils.get_color_from_hex('333333')
    title_size: root.base_size / 16
    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
    size_hint: (None, None)
    width: root.base_size
    height: root.base_size / 1.8
    auto_dismiss: False
    background: 'data/img/board.png'
    title_color: utils.get_color_from_hex('546E7A')

<ResetPopup@CustomPopup>:
    title: 'Reset'
    BoxLayout:
        orientation: 'vertical'
        CustomLabel:
            text: 'Are you sure?'
            color: utils.get_color_from_hex('546E7A')
            bold: True
            font_size: root.base_size / 24
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: root.base_size / 8
            spacing: PADDING
            DangerButton:
                text: 'Yes'
                on_press: root.dismiss() and app.root.ids.board.reset()
                font_size: root.base_size / 24
            InfoButton:
                text: 'No'
                on_press: root.dismiss()
                font_size: root.base_size / 24


<WinPopup@CustomPopup>:
    title: 'Congratulation!'
    BoxLayout:
        orientation: 'vertical'
        CustomLabel:
            text: 'You have successfully reached to 2048'
            color: utils.get_color_from_hex('546E7A')
            bold: True
            font_size: root.base_size / 24
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: root.base_size / 8
            spacing: PADDING
            InfoButton:
                text: 'Continue'
                on_press: root.dismiss() and app.root.ids.board.stop_win_sound()
                font_size: root.base_size / 24

<LosePopup@CustomPopup>:
    title: 'Game over!'
    BoxLayout:
        orientation: 'vertical'
        CustomLabel:
            text: 'Victory is always possible for the person who refuses to stop fighting\n'
            text_size: self.size
            halign: 'center'
            color: utils.get_color_from_hex('546E7A')
            bold: True
            font_size: root.base_size / 24
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: root.base_size / 8
            spacing: PADDING
            InfoButton:
                text: 'Reset and Continue'
                on_press: root.dismiss() and app.root.ids.board.reset()
                font_size: root.base_size / 24